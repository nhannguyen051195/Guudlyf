<% include ./partials/header %>
<title>Main page</title>
<style>
    .answers {
        display: flex;
        justify-content: space-around;
    }
    #welcome_page{
        display:block
    }

    .mainContainer {
        height: 100vh;
        flex: 0 0 100%;
        background-color: #E6E6EA;
    }

    ::-webkit-input-placeholder {
        /* Edge */
        color: #2AB7CA;
    }

    :-ms-input-placeholder {
        /* Internet Explorer 10-11 */
        color: #2AB7CA;
    }

    ::placeholder {
        color: #2AB7CA;
    }



    .setting-item {
        width: 50%;
    }



    .outer {
        overflow-x: hidden;
        overflow-y: hidden;
    }



    body {
        margin: 0;
        overflow: hidden;
    }

    .body {

        padding: 15px;
        border-radius: 17px;
        background: rgba(255, 255, 255, 0.534);

    }

    button {
        cursor: pointer;
    }

    button:focus {
        outline: none;
    }

    .container1 {
        display: flex;
        transition: transform .2s ease-in;
    }



    .inner {
        flex: 0 0 100%;
        height: 100vh;
        display: flex;
        align-items: center;
        padding: 15px;
        background-color: #cccccc;
        background-size: cover;
        background-image: url("rainbow-wallpaper.jpg");
    }



    .lefty {
        left: 0;
        z-index: 1;
    }

    .righty {
        right: 0;
        z-index: 1;
    }

    .button {
        width: 195px;
        background-color: #2AB7CA;
        border: #2AB7CA;
        color: white;
        height: 50px !important;
        border-radius: 50px;
    }

    .button2 {
        width: 195px;
        background-color: "white";

        color: #2AB7CA;
        height: 50px !important;
        border-radius: 50px;
        font-weight: 600;

    }



    .group {
        border: 1px solid #979797;
        width: 150px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 150px;
        border-radius: 25px;
        color: #2AB7CA;
        background-color: #F4F4F8;
        cursor: pointer;
        font-size: 18px;
        border: 1px solid;
        margin: 15px;
    }

    .part1 img {
        height: 60px;
        margin: 10px;
    }





    .setting-row {
        width: 100%;
        display: flex;
        margin: 10px;
    }


    .switch {
        position: relative;
        display: inline-block;
        width: 94px;
        height: 40px;
    }

    /* Hide default HTML checkbox */
    .switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }


    .button-answer {
        display: flex;
        flex-direction: column;
        align-items: center;
        background-color: transparent;
        border-radius: 15px;
        padding: 5px;
        width: 120px;
        cursor: pointer;
        margin: 10px;
        color: rgb(42, 183, 202);
        border: 1px solid;
    }

    .button-answer span {
        font-size: 12px;
        font-weight: 500
    }

    .button-answer img {
        width: 50px;
        height: 50px
    }

    .part1,
    .part2 {
        height: 25vh;
    }


    .common-div {
        height: 100vh;
        flex: 0 0 100%;
        display: none;
        position: relative;
    }

    #setting,
    #who,
    #feedback {
        background-color: #E6E6EA
    }

    .header_logo {
        display: flex;
        justify-content: center;
        height: 25vh;
        position: relative;
    }
    .team-logo{
        position: absolute;
        bottom:0;
        width:100%;
        text-align: center;
    }


    @media only screen and (max-width: 500px) {
       /*  .team-logo{
            display: none;
        } */
        .group {
            width: 130px;
            height: 130px;
        }

        #welcome_page h5 {
            font-size: 1rem;
        }

        .who-question {
            border-radius: 30px !important;
            padding: 10px !important;
        }

        .common-div {
            width: 100%;
        }

        .button-answer {
            display: flex;
            flex-direction: column;
            align-items: center;
            border-radius: 15px !important;
            padding: 5px;
            width: 100%;
            margin: 5px;
        }

        .button-answer img {
            width: 30px;
            height: 30px
        }

        .mainContainer {
            width: 100%;
            overflow: visible;
        }

        .part3 {
            height: 50vh !important;
            overflow: auto;
        }

        .part1,
        .part2,
        .part3 {
            height: auto !important;
        }

        .part1 img {
            height: 42px !important;
        }

        .part2 {
            margin: 15px 0;
        }



        .part2Container {
            font-size: 18px !important;
            border-radius: 15px !important;
            height: auto !important;

        }

        .part3Container {
            width: 80%;
            padding: 15px;
            font-size: 30px;
            border-radius: 15px !important;
            flex-direction: column-reverse;
            align-items: center;
        }

        .part4 h5 {
            display: none;
        }

        .who-question {
            font-size: 22px !important;
        }

        .part4Container {
            align-items: start !important;
            height: auto !important;
        }

        .part4 {
            align-items: start !important;
            margin-top: 15px;
            margin-bottom: 30px;
            height: auto !important;
        }
    }
</style>

<body>
    <div class="outer">
        <div class="outer" id="common-div-outer">
            <div class="container1" id="container2">
                <div class="common-div" id="welcome_page">
                    <div class="header_logo">
                        <div class="w-100 justify-content-center d-flex position-relative" style="height: 100px;">
                            <img style="height: 60px; margin-top: 10px;" src="HELSINKI_Tunnus_MUSTA.png" alt="">
                            <button onclick="goTo('setting','welcome_page')"
                                class="position-absolute h-100 d-flex align-items-center"
                                style="border: 0px;background-color: transparent; right: 10px;font-size: 30px;cursor: pointer;">
                                <i class="fa fa-cog" aria-hidden="true"></i>
                            </button>
                        </div>
                    </div>
                    <div class="justify-content-center d-flex align-items-center text-center flex-column"
                        style="padding:15px;height: 25vh; color:#2AB7CA">
                        <h2>Tervetuloa!</h2>
                        <h5>Vastaamalla kyselyyn autat meitä parantamaan viihtyvyyttä rakennuksen sisällä!</h4>
                    </div>
                    <div class="justify-content-center d-flex align-items-center flex-column" style="height: 25vh;">
                        <button style="margin: 10px;" onclick="goTo('who',null)" class='btn button'>Aloita
                            kysely</button>
                        <button style="margin: 10px;" onclick="goTo('feedback',null)" class='btn button'>Anna avoin
                            palaute</button>
                    </div>
                    <div class="wave position-relative" style="height:25vh;">
                        <svg viewBox="0 -20 700 110" width="100%" height="100%" preserveAspectRatio="none">
                            <path transform="translate(0, -20)"
                                d="M0,10 c80,-22 240,0 350,18 c90,17 260,7.5 350,-20 v50 h-700" fill="#2AB7CA"></path>
                            <path d="M0,10 c80,-18 230,-12 350,7 c80,13 260,17 350,-5 v100 h-700z" fill="#2AB7CA">
                            </path>
                        </svg>
                        <h6 class="team-logo"  style="color: white;">Guudlyf 2019
                            </h6>
                     
                    </div>
                
                </div>



                <div class="common-div" id="setting">
                    <div style="height: 25vh; ">
                        <div class="w-100 justify-content-center d-flex position-relative"
                            style="height:100px;background-color: #F4F4F8;">
                            <img style="height: 60px; margin-top: 10px;"src="HELSINKI_Tunnus_MUSTA.png" alt="">
                            <button onclick="goBackTo()" class="position-absolute h-100 d-flex align-items-center"
                                style="background-color: transparent; border:0px; right: 10px;font-size: 30px; cursor: pointer;">
                                X</button>
                        </div>
                    </div>
                    <div class="justify-content-center d-flex" style="height: 50vh;">
                        <div class="d-flex align-items-center w-90 h-90 flex-column"
                            style="background-color: #F4F4F8;border-radius: 30px;color: #2AB7CA;padding: 15px;">
                            <div class="setting-row">
                                <div class="setting-item">Valitse rakennus</div>
                                <select style="background-color: white;color: #2AB7CA;border-color: #2AB7CA;"
                                    class="setting-item" id="schoolname">
                                    <option value="0"> -- Valitse rakennus --</option>
                                    <option selected value="Kaisaniemen ala-aste">Kaisaniemen ala-aste</option>
                                    <option value="Keinutien ala-aste">Keinutien ala-aste</option>
                                    <option value="Myllypuron peruskoulu">Myllypuron peruskoulu</option>
                                    <option value="Meritalo">Meritalo</option>
                                </select>
                            </div>
                            <div class="setting-row">
                                <div class="setting-item">Syötä huoneen numero</div>
                                <input id="schoolclass" style="background-color: white;color: #2AB7CA;border: #2AB7CA;"
                                    class="setting-item">

                            </div>
                            <div class="setting-row">
                                <div style="margin-top: 10px;" class="setting-item">Helppokäyttötila</div>
                                <div class="setting-item" style="margin: auto;">

                                    <label class="switch">
                                        <input type="checkbox">
                                        <span class="slider round"></span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div style="display: flex; justify-content:center; height: 25vh; align-items: center; ">
                        <div style="height: 100px;display: flex;justify-content: space-between;">
                        </div>
                        <h6 class="team-logo" style="color: #BBBBBB;">Guudlyf
                            2019
                        </h6>
                    </div>
                </div>

                <div class="common-div" id='who'>
                    <div class="header_logo" style="height: 25vh;">
                        <div
                            style="background-color: #F4F4F8;width: 100%;justify-content: center;display: flex; position: relative;height: 100px;">
                            <img style="height: 60px; margin-top: 10px;" src="HELSINKI_Tunnus_MUSTA.png" alt="">
                            <button onclick="goTo('setting','who')"
                                style="background-color: transparent;border:0px;position: absolute;right: 10px;height: 100%;font-size: 30px;display: flex;align-items: center; cursor: pointer;">
                                <i class="fa fa-cog" aria-hidden="true"></i>
                            </button>
                        </div>
                    </div>
                    <div class="part2" style="display: flex; justify-content:center; height: 25vh;">
                        <div class="who-question"
                            style="height:50%;text-align:center;display: flex;justify-content: center;align-items: center;background-color: #F4F4F8;width: 80%;border-radius: 50px;color: #2AB7CA;font-size: 30px;">
                            Oletko oppilas vaihenkilökuntaa?
                        </div>
                    </div>
                    <div style="display: flex; justify-content:center; height: 25vh; align-items: center;">
                        <div style="display: flex;justify-content: space-between;">
                            <button onclick="highlight(this,'student')" class="group"><img style="width: 50px; "
                                    src="icons8-children-64.png"> Oppilas
                            </button>
                            <button onclick="highlight(this,'teacher')" class="group"><img style="width: 60px; "
                                    src="icons8-teacher-100.png">Henkilökunta
                            </button>
                        </div>

                    </div>
                    <div class="position-relative"  style="display: flex; justify-content:center; height: 25vh; align-items: center; ">
                        <div style="width:80%;height: 100px;display: flex;;justify-content: space-between;">
                            <button style="margin: 10px;" onclick="goTo('welcome_page',null)"
                                class='btn button'>Edellinen</button>
                            <button style="margin: 10px;" disabled id="startsurvey"
                                style="background-color: white;color: #2AB7CA" onclick="startServey()"
                                class='btn button'>Seuraava</button>

                        </div>
                        <h6  class="team-logo" style="color: #BBBBBB;">Guudlyf
                                2019
                            </h6>
                     
                    </div>
                  
                </div>

                <div class="common-div" id='feedback'>
                    <div style="height: 25vh; ">
                        <div
                            style="background-color: #F4F4F8;width: 100%;justify-content: center;display: flex; position: relative;height: 100px;">
                            <img style="height: 60px; margin-top: 10px;" src="HELSINKI_Tunnus_MUSTA.png" alt="">
                            <button onclick="goTo('setting', 'feedback')"
                                style="border:0;position: absolute;    background-color: transparent;
                            right: 10px;height: 100%;font-size: 30px;display: flex;align-items: center; cursor: pointer;">
                                <i class="fa fa-cog" aria-hidden="true"></i>
                            </button>
                        </div>
                    </div>
                    <div style="display: flex; justify-content:center; height: 25vh;">
                        <div
                            style="    padding: 15px;
                        text-align:center;display: flex;justify-content: center;align-items: center;background-color: #F4F4F8;width: 80%;border-radius: 30px;color: #2AB7CA;font-size: 30px; height: 60%;">
                            <h5>Halutessasi voit jättää alle avoimen palautteen.</h5>
                        </div>
                    </div>
                    <div style="display: flex; justify-content:center; height: 25vh;">
                        <textarea id="feedback"
                            style="display: flex;justify-content: center;align-items: center;background-color: #F4F4F8;width: 80%;border-radius: 30px;color: #2AB7CA;font-size: 20px;padding: 15px;border: #F4F4F8;"
                            placeholder="Kouluruoka oli tänään superhyvää!"></textarea>
                    </div>
                    <div style="display: flex; justify-content:center; height: 25vh; align-items: center; ">
                        <div style="height: 100px;display: flex;width: 80%;justify-content: space-between;">
                            <button style="margin: 10px;" onclick="goTo('welcome_page',null)"
                                class='btn button'>Edellinen</button>
                            <button style="margin: 10px;" onclick="sendFeedback()" class='btn button'>Lähetä</button>

                        </div>
                        <h6  class="team-logo"style="position: fixed;bottom: 12px;width: 100%;text-align: center;color: #BBBBBB;">Guudlyf
                            2019
                        </h6>
                    </div>


                </div>
                <div class="common-div" id='thankyou'>
                    <div class="header_logo">
                        <div
                            style="width: 100%;justify-content: center;display: flex; position: relative;height: 100px;">
                            <img style="height: 60px; margin-top: 10px;" src="HELSINKI_Tunnus_MUSTA.png" alt="">

                        </div>
                    </div>
                    <div
                        style="padding:15px;text-align:center;display: flex;justify-content: center;height: 25vh;align-items: center;flex-direction: column; color:#2AB7CA">
                        <h1>Kiitos!</h1>
                        <h5>Antamalla palautetta autat meitä saavuttamaan mukavan paikan opiskella ja työskennellä.</h5>
                    </div>
                    <div
                        style="display: flex;justify-content: center;height: 25vh;flex-direction: column;align-items: center;">
                        <button style="margin: 10px;" onclick="goTo('welcome_page',null)" class='btn button'>Aloita
                            alusta</button>
                        <button style="margin: 10px;" onclick="goTo('feedback',null)"
                            class="btn button waves-effect waves-light">Anna avoin
                            palaute</button>
                    </div>
                    <div class="wave" style="position: relative;height:25vh;">
                        <svg viewBox="0 -20 700 110" width="100%" height="100%" preserveAspectRatio="none">
                            <path transform="translate(0, -20)"
                                d="M0,10 c80,-22 240,0 350,18 c90,17 260,7.5 350,-20 v50 h-700" fill="#2AB7CA"></path>
                            <path d="M0,10 c80,-18 230,-12 350,7 c80,13 260,17 350,-5 v100 h-700z" fill="#2AB7CA">
                            </path>
                        </svg>
                        <h6 class="team-logo" style="position: fixed;bottom: 12px;width: 100%;text-align: center;color: white; left:0">
                            Guudlyf
                            2019</h6>

                    </div>

                </div>
            </div>
        </div>

        <div class="outer" id="content">
            <div id="container1" class="container1">

            </div>

        </div>
    </div>
    <p id="questions" style="display:none"><%= posts %></p>
    <button style="display: none;" class="lefty" id="left-button"><i class="fa fa-chevron-left"></i></button>
    <button style="display: none;" class="righty" id="right-button"><i class="fa fa-chevron-right"></i></button>
</body>
<script>
    var questions = JSON.parse(document.getElementById("questions").innerText);
    var peopleGroup = null

    sendFeedback = () => {
        goTo('thankyou', null)
        var data = {
            "feedback": $("textarea#feedback").val(),
            "schoolname": $("#schoolname").val(),
            "schoolclass": $("#schoolclass").val()
        }
        if (!$("textarea#feedback").val()) return
        $.ajax({
            type: "POST",
            url: "/feedback",
            data: JSON.stringify(data),
            contentType: 'application/json',
        }).then(function (data) {
            $("textarea#feedback").val("")

        })
    }
    let prev = null
    goTo = (id, prevId) => {
        $('.common-div').hide()
        $('#' + id).show()
        $('#' + id)[0].scrollIntoView(true);
        prev = prevId
    }
    goBackTo = () => {
        if (prev) {
            $('.common-div').hide()
            $('#' + prev).show()
            $('#' + prev)[0].scrollIntoView(true);


        }

    }
    highlight = (e, input) => {
        $('.group').css({ "box-shadow": "", "border": "1px solid" })
        $("#startsurvey").prop("disabled", false)
        $("#startsurvey").css({ "background-color": "#2AB7CA", "color": "white" })
        peopleGroup = input
        if (input) {
            $(e).css({ "box-shadow": "0 0 40px rgb(42, 183, 202)", "border": "2px solid" })
        }

    }

    const container = document.querySelector("#container1");
    const lefty = document.querySelector(".lefty");
    let translate = 0;
    let maxTranslate = null;

    lefty.addEventListener("click", function () {
        if (!maxTranslate) return
        if (translate == 0) {
            translate = 0
            return
        }
        translate += 100;
        container.style.transform = "translateX(" + translate + "vw" + ")";
    });

    const righty = document.querySelector(".righty");
    righty.addEventListener("click", function () {
        if (!maxTranslate) return
        if (translate == -maxTranslate) {
            translate = -maxTranslate
            return
        }

        translate -= 100;
        container.style.transform = "translateX(" + translate + "vw" + ")";
    });
    var sendAnswer = function (e) {
        var data = {
            "answerId": e.target.answerId,
            "answer": e.target.answer,
            "questionId": e.target.questionId,
            "question": e.target.question,
            "schoolname": $("#schoolname").val(),
            "schoolclass": $("#schoolclass").val(),
            "peopleGroup": peopleGroup
        }
        $.ajax({
            type: "POST",
            url: "/answers",
            data: JSON.stringify(data),
            contentType: 'application/json',
        })
    }
    startServey = () => {
        $("#container1").empty()
        getData(questions)

    }

    getData = (questions) => {
        container.style.transform = "translateX(" + 0 + "vw" + ")";
        translate = 0;
        maxTranslate = null

        maxTranslate = (questions.length - 1) * 100
        questions.forEach((question, index) => {

            var question_type = "question.question_type"

            var mainContainer = document.createElement("div")
            mainContainer.className = "mainContainer"
            mainContainer.id = "mainContainer" + question.questionId

            var part1 = document.createElement("div")
            // part1.style.height = "25vh";
            part1.className = 'part1 '

            var part1Container = document.createElement("div");
       /*      part1Container.style.backgroundColor = '#F4F4F8';
            part1Container.style.width = '100%';
            part1Container.style.display = 'flex';
            part1Container.style.justifyContent = 'center';
            part1Container.style.position = 'relative';
            part1Container.style.height = 'auto'; */
            part1Container.style.backgroundColor = '#F4F4F8';
            part1Container.className = 'w-100 justify-content-center d-flex position-relative'

            var part1Img = document.createElement('img');
            part1Img.style.height = '60px'
            part1Img.style.marginTop = '10px'

            part1Img.src = 'HELSINKI_Tunnus_MUSTA.png'

            var part1Btn = document.createElement("button")
            part1Btn.style.backgroundColor = 'transparent'
            part1Btn.style.border = '0'
            part1Btn.style.position = 'absolute';
            part1Btn.style.right = '10px';
            part1Btn.style.height = '100%';
            part1Btn.style.fontSize = '30px';

            part1Btn.addEventListener("click", function () {
                goTo('setting', 'who')
            })

            var part1Icon = document.createElement("i")
            part1Icon.className = "fa fa-cog"

            part1Btn.appendChild(part1Icon)
            part1Container.appendChild(part1Img)
            part1.appendChild(part1Container)


            var part2 = document.createElement("div")
            part2.style.display = 'flex';
            part2.style.justifyContent = 'center';
            part2.className = 'part2'

            var part2Container = document.createElement("div")
            part2Container.className = 'part2Container';

            part2Container.style.backgroundColor = '#F4F4F8';
            part2Container.style.width = '80%';
            part2Container.style.display = 'flex';
            part2Container.style.justifyContent = 'center';
            part2Container.style.alignItems = 'center';
            part2Container.style.color = '#2AB7CA';
            part2Container.style.fontSize = '30px';
            part2Container.style.borderRadius = '50px';
            part2Container.style.textAlign = 'center';
            part2Container.style.padding = '15px';
            part2Container.style.height = '50%';

            part2Container.innerHTML = question.question
            part2.appendChild(part2Container)


            var part3 = document.createElement("div")
            part3.style.display = 'flex';
            part3.style.justifyContent = 'center';

            part3.style.height = '25vh';
            part3.style.alignItems = 'center';
            part3.className = "part3"

            var part3Container = document.createElement("div")
            part3Container.style.backgroundColor = '#F4F4F8';
            part3Container.style.width = '80%';
            part3Container.style.padding = '15px';
            part3Container.style.display = 'flex';
            part3Container.style.justifyContent = 'center';
            part3Container.style.color = '#2AB7CA';
            part3Container.style.fontSize = '30px';
            part3Container.style.borderRadius = '50px';
            part3Container.className = 'part3Container';

            part3.appendChild(part3Container)

            var part4 = document.createElement("div")
            part4.style.display = 'flex';
            part4.style.justifyContent = 'center';
            part4.style.height = '25vh';
            part4.style.alignItems = 'center';
            part4.style.position = 'relative';
            part4.className = 'part4';


            var part4Container = document.createElement("div")
            part4Container.style.width = '80%';
            part4Container.style.display = 'flex';
            part4Container.style.justifyContent = 'space-between';
            part4Container.style.alignItems = 'center';
            part4Container.style.height = '100px';
            part4Container.className = 'part4Container'

            var part4btn1 = document.createElement("button")
            part4btn1.className = "btn button";
            part4btn1.innerHTML = "Edellinen"
            part4btn1.addEventListener("click", function () {
                if (index == 0) {
                    goTo("who", null)
                    $("#common-div-outer").show()
                    $("#container1").empty()
                }
                else {
                    $("#left-button").click()
                }
            })

            var part4span = document.createElement("span")
            part4span.innerHTML = index + 1 + "/8";
            part4span.style.color = "#2AB7CA"
            part4span.style.margin = "10px"

            var part4btn2 = document.createElement("button")
            part4btn2.className = "btn button2";
            part4btn2.innerHTML = index == 7 ? "Lähetä" : "Seuraava"
            part4btn2.disabled = "true"


            part4btn2.addEventListener("click", function (e) {
                sendAnswer(e)
                if (index == 7) {
                    $("#container2, #common-div-outer").show()
                    goTo("thankyou", null)
                    $("#container1").empty()
                    highlight("teacher", null)

                }
                else {
                    $("#right-button").click()
                }
            })

            part4Container.appendChild(part4btn1)
            part4Container.appendChild(part4span)
            part4Container.appendChild(part4btn2)

            var h6 = document.createElement("h6")
            h6.innerHTML = "Guudlyf 2019";
            h6.className="team-logo"
            h6.style.color = '#BBBBBB';


            part4.appendChild(part4Container)
           // part4.appendChild(h6)

            mainContainer.appendChild(part1)
            mainContainer.appendChild(part2)
            mainContainer.appendChild(part3)
            mainContainer.appendChild(part4)
            mainContainer.appendChild(h6)


            document.getElementById("container1").appendChild(mainContainer);
            var choices = question.choices
            choices.map(item => {
                var choice = document.createElement("button")
                choice.className = 'button-answer'
                choice.questionId = question.questionId;
                choice.id = item.choiceId;
                var icon = document.createElement("img");
                icon.src = item.icon;

                var text = document.createElement("span");
                text.innerHTML = item.choice

                choice.appendChild(icon);
                choice.appendChild(text)
                part3Container.appendChild(choice)

                $(choice).click(function (event) {
                    $(part4btn2).prop("disabled", false)
                    event.preventDefault()
                    $('.button-answer').css({ "box-shadow": "", "border": "1px solid" })
                    $(event.currentTarget).css({ "box-shadow": "0 0 40px rgb(42, 183, 202)", "border": "2px solid" })
                    $(part4btn2).css({ "background-color": "#2AB7CA", "color": "white" })
                    $(part4btn2).prop({ "questionId": question.questionId, "answer": item.choice, "answerId": item.choiceId, "question": question.question })
                })
            })
        })
        $(document).scrollTo('#content');
        $("#common-div-outer").hide()
    }
</script>
<% include ./partials/footer %>